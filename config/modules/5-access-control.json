{
  "section": "5",
  "title": "Access, Authentication and Authorization",
  "description": "SSH, sudo, PAM, user accounts",
  "controls": [
    {
      "id": "5.1.1",
      "title": "Ensure permissions on /etc/ssh/sshd_config are configured",
      "type": "file-perms",
      "path": "/etc/ssh/sshd_config",
      "mode": "600",
      "owner": "root",
      "group": "root"
    },
    {
      "id": "5.1.2",
      "title": "Ensure permissions on SSH private host key files are configured",
      "type": "file-perms",
      "path": "/etc/ssh/ssh_host_rsa_key",
      "mode": "600",
      "owner": "root",
      "group": "root"
    },
    {
      "id": "5.1.3",
      "title": "Ensure permissions on SSH public host key files are configured",
      "type": "file-perms",
      "path": "/etc/ssh/ssh_host_rsa_key.pub",
      "mode": "644",
      "owner": "root",
      "group": "root"
    },
    {
      "id": "5.1.4",
      "title": "Ensure sshd access is configured",
      "type": "command",
      "audit_cmd": "sshd -T 2>/dev/null | grep -Ei '^\\s*(allow|deny)(users|groups)'",
      "match": "not_empty",
      "audit_only": true
    },
    {
      "id": "5.1.5",
      "title": "Ensure sshd Banner is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "Banner",
      "expected": "/etc/issue.net"
    },
    {
      "id": "5.1.6",
      "title": "Ensure sshd Ciphers are configured",
      "type": "command",
      "audit_cmd": "sshd -T 2>/dev/null | grep '^ciphers' | grep -Ei '3des-cbc|aes128-cbc|aes192-cbc|aes256-cbc'",
      "match": "empty"
    },
    {
      "id": "5.1.7",
      "title": "Ensure sshd ClientAliveInterval is configured",
      "type": "command",
      "audit_cmd": "sshd -T 2>/dev/null | grep '^clientaliveinterval'",
      "expected": "^clientaliveinterval [1-9]",
      "match": "regex"
    },
    {
      "id": "5.1.8",
      "title": "Ensure sshd ClientAliveCountMax is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "ClientAliveCountMax",
      "expected": "3"
    },
    {
      "id": "5.1.9",
      "title": "Ensure sshd DisableForwarding is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "DisableForwarding",
      "expected": "yes"
    },
    {
      "id": "5.1.10",
      "title": "Ensure sshd GSSAPIAuthentication is disabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "GSSAPIAuthentication",
      "expected": "no"
    },
    {
      "id": "5.1.11",
      "title": "Ensure sshd HostbasedAuthentication is disabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "HostbasedAuthentication",
      "expected": "no"
    },
    {
      "id": "5.1.12",
      "title": "Ensure sshd IgnoreRhosts is enabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "IgnoreRhosts",
      "expected": "yes"
    },
    {
      "id": "5.1.13",
      "title": "Ensure sshd KexAlgorithms is configured",
      "type": "command",
      "audit_cmd": "sshd -T 2>/dev/null | grep '^kexalgorithms' | grep -Ei 'diffie-hellman-group1-sha1|diffie-hellman-group14-sha1|diffie-hellman-group-exchange-sha1'",
      "match": "empty"
    },
    {
      "id": "5.1.14",
      "title": "Ensure sshd LoginGraceTime is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "LoginGraceTime",
      "expected": "60"
    },
    {
      "id": "5.1.15",
      "title": "Ensure sshd LogLevel is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "LogLevel",
      "expected": "INFO"
    },
    {
      "id": "5.1.16",
      "title": "Ensure sshd MACs are configured",
      "type": "command",
      "audit_cmd": "sshd -T 2>/dev/null | grep '^macs' | grep -Ei 'hmac-md5|hmac-sha1-96|umac-64'",
      "match": "empty"
    },
    {
      "id": "5.1.17",
      "title": "Ensure sshd MaxAuthTries is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "MaxAuthTries",
      "expected": "4"
    },
    {
      "id": "5.1.18",
      "title": "Ensure sshd MaxSessions is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "MaxSessions",
      "expected": "10"
    },
    {
      "id": "5.1.19",
      "title": "Ensure sshd MaxStartups is configured",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "MaxStartups",
      "expected": "10:30:60"
    },
    {
      "id": "5.1.20",
      "title": "Ensure sshd PermitEmptyPasswords is disabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "PermitEmptyPasswords",
      "expected": "no"
    },
    {
      "id": "5.1.21",
      "title": "Ensure sshd PermitRootLogin is disabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "PermitRootLogin",
      "expected": "no"
    },
    {
      "id": "5.1.22",
      "title": "Ensure sshd PermitUserEnvironment is disabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "PermitUserEnvironment",
      "expected": "no"
    },
    {
      "id": "5.1.23",
      "title": "Ensure sshd UsePAM is enabled",
      "type": "file-content",
      "file": "/etc/ssh/sshd_config",
      "directive": "UsePAM",
      "expected": "yes"
    },
    {
      "id": "5.2.1",
      "title": "Ensure sudo is installed",
      "type": "package",
      "package": "sudo",
      "expected": "installed"
    },
    {
      "id": "5.2.2",
      "title": "Ensure sudo commands use pty",
      "type": "command",
      "audit_cmd": "grep -rEi '^\\s*Defaults\\s+.*use_pty' /etc/sudoers /etc/sudoers.d/ 2>/dev/null",
      "match": "not_empty"
    },
    {
      "id": "5.2.3",
      "title": "Ensure sudo log file exists",
      "type": "command",
      "audit_cmd": "grep -rEi '^\\s*Defaults\\s+logfile=' /etc/sudoers /etc/sudoers.d/ 2>/dev/null",
      "match": "not_empty"
    },
    {
      "id": "5.2.4",
      "title": "Ensure users must provide password for privilege escalation",
      "type": "command",
      "audit_cmd": "grep -rEi '^\\s*[^#].*NOPASSWD' /etc/sudoers /etc/sudoers.d/ 2>/dev/null",
      "match": "empty"
    },
    {
      "id": "5.2.5",
      "title": "Ensure re-authentication for privilege escalation is not disabled",
      "type": "command",
      "audit_cmd": "grep -rEi '^\\s*[^#].*!authenticate' /etc/sudoers /etc/sudoers.d/ 2>/dev/null",
      "match": "empty"
    },
    {
      "id": "5.2.6",
      "title": "Ensure sudo authentication timeout is configured correctly",
      "type": "command",
      "audit_cmd": "grep -rEi '^\\s*Defaults\\s+.*timestamp_timeout' /etc/sudoers /etc/sudoers.d/ 2>/dev/null",
      "expected": "timestamp_timeout",
      "match": "contains"
    },
    {
      "id": "5.2.7",
      "title": "Ensure access to the su command is restricted",
      "type": "command",
      "audit_cmd": "grep -E '^\\s*auth\\s+required\\s+pam_wheel.so' /etc/pam.d/su",
      "match": "not_empty"
    },
    {
      "id": "5.3.1",
      "title": "Ensure pam_faillock module is enabled",
      "type": "pam",
      "check_type": "faillock",
      "directive": "deny",
      "expected": "5"
    },
    {
      "id": "5.3.2",
      "title": "Ensure lockout duration is configured",
      "type": "pam",
      "check_type": "faillock",
      "directive": "unlock_time",
      "expected": "900"
    },
    {
      "id": "5.3.3",
      "title": "Ensure password failed attempts lockout includes root",
      "type": "pam",
      "check_type": "faillock",
      "directive": "even_deny_root",
      "expected": "",
      "audit_only": true
    },
    {
      "id": "5.3.4",
      "title": "Ensure password hashing algorithm is SHA-512 or yescrypt",
      "type": "command",
      "audit_cmd": "grep -Ei '^\\s*ENCRYPT_METHOD' /etc/login.defs",
      "expected": "SHA512|yescrypt",
      "match": "regex"
    },
    {
      "id": "5.3.5",
      "title": "Ensure minimum password length is configured",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "minlen",
      "expected": "14"
    },
    {
      "id": "5.3.6",
      "title": "Ensure password complexity is configured - dcredit",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "dcredit",
      "expected": "-1"
    },
    {
      "id": "5.3.7",
      "title": "Ensure password complexity is configured - ucredit",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "ucredit",
      "expected": "-1"
    },
    {
      "id": "5.3.8",
      "title": "Ensure password complexity is configured - lcredit",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "lcredit",
      "expected": "-1"
    },
    {
      "id": "5.3.9",
      "title": "Ensure password complexity is configured - ocredit",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "ocredit",
      "expected": "-1"
    },
    {
      "id": "5.3.10",
      "title": "Ensure password reuse is limited",
      "type": "pam",
      "check_type": "pwquality",
      "directive": "remember",
      "expected": "24"
    },
    {
      "id": "5.4.1",
      "title": "Ensure password expiration is configured",
      "type": "file-content",
      "file": "/etc/login.defs",
      "directive": "PASS_MAX_DAYS",
      "expected": "365"
    },
    {
      "id": "5.4.2",
      "title": "Ensure minimum password age is configured",
      "type": "file-content",
      "file": "/etc/login.defs",
      "directive": "PASS_MIN_DAYS",
      "expected": "1"
    },
    {
      "id": "5.4.3",
      "title": "Ensure password expiration warning days is configured",
      "type": "file-content",
      "file": "/etc/login.defs",
      "directive": "PASS_WARN_AGE",
      "expected": "7"
    },
    {
      "id": "5.4.4",
      "title": "Ensure inactive password lock is configured",
      "type": "command",
      "audit_cmd": "useradd -D | grep INACTIVE",
      "expected": "INACTIVE=30",
      "match": "contains",
      "audit_only": true
    },
    {
      "id": "5.4.5",
      "title": "Ensure default group for the root account is GID 0",
      "type": "command",
      "audit_cmd": "grep '^root:' /etc/passwd | cut -d: -f4",
      "expected": "0",
      "match": "exact"
    },
    {
      "id": "5.4.6",
      "title": "Ensure default user umask is configured",
      "type": "file-content",
      "file": "/etc/login.defs",
      "directive": "UMASK",
      "expected": "027"
    },
    {
      "id": "5.4.7",
      "title": "Ensure default user shell timeout is configured",
      "type": "command",
      "audit_cmd": "grep -E '^TMOUT=' /etc/profile /etc/profile.d/*.sh /etc/bashrc 2>/dev/null | head -1",
      "expected": "TMOUT=",
      "match": "contains"
    },
    {
      "id": "5.4.8",
      "title": "Ensure root login is restricted to system console",
      "type": "command",
      "audit_cmd": "cat /etc/securetty 2>/dev/null | wc -l",
      "match": "not_empty"
    },
    {
      "id": "5.4.9",
      "title": "Ensure access to the root account is logged",
      "type": "command",
      "audit_cmd": "grep -E '^auth.*pam_tally2|^auth.*pam_faillock' /etc/pam.d/system-auth /etc/pam.d/password-auth 2>/dev/null",
      "match": "not_empty"
    }
  ]
}
